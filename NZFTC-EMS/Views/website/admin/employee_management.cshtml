@using NZFTC_EMS.Data.Entities
@model IEnumerable<NZFTC_EMS.Data.Entities.Employee>

@{
    Layout = "~/Views/Shared/_portal.cshtml";
    ViewData["Title"] = "Employee Management";
}

<link rel="stylesheet" href="~/css/employee.css" asp-append-version="true" />

<div class="page-container">

    <!-- PAGE HEADER -->
    <div class="header-row d-flex justify-content-between align-items-center mb-3">
        <h2 class="page-title fw-bold mb-0">Employee Management</h2>

        <a asp-controller="employee_management"
           asp-action="Create"
           class="btn btn-primary ems-btn-primary">
            + Add Employee
        </a>

    </div>

    @if (TempData["msg"] != null)
    {
        <div class="alert alert-info mb-3">@TempData["msg"]</div>
    }

    <!-- FILTER BAR -->
    <div class="card shadow-sm border-0 filter-card mb-4">
        <div class="card-body">
            <form class="row g-2 align-items-end"
                  asp-controller="employee_management"
                  asp-action="Index"
                  method="get">

                <div class="col-md-5">
                    <label class="form-label small text-muted">Search</label>
                    <input class="form-control"
                           type="search"
                           name="q"
                           value="@ViewBag.Search"
                           placeholder="Search by name or email" />
                </div>

                <div class="col-md-4">
                    <label class="form-label small text-muted">Department</label>
                    <select class="form-select" name="department">
                        @{
                            var selectedDept = ViewBag.Department as string ?? "All";
                        }
                        <option value="All" selected="@(selectedDept == "All")">All Departments</option>
                        <option value="HR" selected="@(selectedDept == "HR")">HR</option>
                        <option value="Finance" selected="@(selectedDept == "Finance")">Finance</option>
                        <option value="IT" selected="@(selectedDept == "IT")">IT</option>
                        <option value="Operations" selected="@(selectedDept == "Operations")">Operations</option>
                    </select>
                </div>

                <div class="col-md-3 text-md-end">
                    <button class="btn btn-primary mt-3 mt-md-0" type="submit">Filter</button>
                </div>
            </form>
        </div>
    </div>

    <!-- TABLE -->
    <div class="card shadow-sm border-0">
        <div class="card-body">
            @if (Model != null && Model.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover align-middle styled-table mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Employee No.</th>
                                <th>Name</th>
                                <th>Job Position</th>
                                <th>Department</th>
                                <th>Email</th>
                                <th>Basic Pay</th>
                                <th>Start Date</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var emp in Model)
                            {
                                <tr>
                                    <td>@emp.EmployeeCode</td>
                                    <td>@($"{emp.FirstName} {emp.LastName}")</td>
                                    <td>@(emp.JobPosition?.Name ?? "—")</td>
                                    <td>@(emp.Department ?? emp.JobPosition?.Department ?? "—")</td>
                                    <td>@emp.Email</td>
                                    <td>
                                        @if (emp.PayGrade != null)
                                        {
                                            @emp.PayGrade.BaseRate.ToString("C2")
                                        }
                                        else
                                        {
                                            <span class="text-muted">—</span>
                                        }
                                </td>
                                <td>
                                    @(emp.StartDate == default(DateTime)
                                                                    ? "—"
                                                                    : emp.StartDate.ToString("dd/MM/yyyy"))
                                    </td>
                                    <td class="text-end">
                                        <a asp-controller="employee_management"
                                           asp-action="Details"
                                           asp-route-id="@emp.EmployeeId"
                                           class="btn btn-sm ems-outline-info">
                                            Details
                                        </a>
                                        <a asp-controller="employee_management"
                                           asp-action="Edit"
                                           asp-route-id="@emp.EmployeeId"
                                           class="btn btn-sm ems-outline-warning">
                                            Edit
                                        </a>
                                        <a asp-controller="employee_management"
                                           asp-action="Delete"
                                           asp-route-id="@emp.EmployeeId"
                                           class="btn btn-sm ems-outline-danger">
                                            Delete
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-muted mb-0">No employees found.</p>
            }
        </div>
    </div>
</div>

