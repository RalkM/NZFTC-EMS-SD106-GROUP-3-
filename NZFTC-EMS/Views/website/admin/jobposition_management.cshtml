@using NZFTC_EMS.Data.Entities
@model IEnumerable<JobPosition>

@{
    Layout = "~/Views/Shared/_portal.cshtml";
    ViewData["Title"] = "Job Position Management";

    var currentSearch = ViewBag.Search as string;
    var currentDept   = ViewBag.Department as string ?? "All";
    var deptOptions   = ViewBag.DepartmentOptions as List<string> ?? new List<string>();
}

<h2>Job Position Management</h2>

@if (TempData["msg"] != null)
{
    <div class="alert alert-info">@TempData["msg"]</div>
}

<form method="get" class="row g-2 align-items-end mb-3">
    <div class="col-md-4">
        <label class="form-label">Search</label>
        <input type="text"
               name="q"
               value="@currentSearch"
               class="form-control"
               placeholder="Search by title, department, description..." />
    </div>

    <div class="col-md-3">
        <label class="form-label">Department</label>
        <select name="department" class="form-select">
            <option value="All" selected="@(currentDept == "All" ? "selected" : null)">All departments</option>
            @foreach (var dept in deptOptions)
            {
                <option value="@dept" selected="@(dept == currentDept ? "selected" : null)">
                    @dept
                </option>
            }
        </select>
    </div>

    <div class="col-md-3">
        <button type="submit" class="btn btn-primary me-2">Apply</button>
        <a asp-controller="jobposition_management"
           asp-action="Index"
           class="btn btn-outline-secondary">
            Reset
        </a>
    </div>

    <div class="col-md-2 text-md-end mt-2 mt-md-0">
        <a asp-controller="jobposition_management"
           asp-action="Create"
           class="btn btn-success w-100">
            + Add Job Position
        </a>
    </div>
</form>

<!-- ðŸ”¹ Scrollable table wrapper -->
<div class="table-responsive jobposition-table-wrapper">
    <table class="table table-striped table-bordered align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th>Id</th>
                <th>Department</th>
                <th>Job Title</th>
                <th>Pay Grade</th>
                <th>Access Role</th>
                <th>Active</th>
                <th style="width:160px;">Actions</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var jp in Model)
        {
            <tr>
                <td>@jp.JobPositionId</td>
                <td>@jp.Department</td>
                <td>@jp.Name</td>
                <td>@jp.PayGrade?.Name</td>
                <td>@jp.AccessRole</td>
                <td>@(jp.IsActive ? "Yes" : "No")</td>
                <td>
                    <a asp-controller="jobposition_management"
                       asp-action="Edit" asp-route-id="@jp.JobPositionId"
                       class="btn btn-sm btn-primary me-1">Edit</a>
                    <a asp-controller="jobposition_management"
                       asp-action="Delete" asp-route-id="@jp.JobPositionId"
                       class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>
