@using NZFTC_EMS.Controllers
@model IEnumerable<PayrollRowVm>


@{
   Layout = ViewData["Layout"]?.ToString();
    ViewData["Title"] = "Payroll Management";
    var rows = Model ?? Enumerable.Empty<PayrollRowVm>();

    var q = ViewBag.Search as string;
    var min = ViewBag.Min as decimal?;
    var max = ViewBag.Max as decimal?;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="~/css/portal-StyleSheet.css" />

<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0 fw-bold">Payroll Management</h3>

    <div class="d-flex gap-2">
      <a asp-controller="payroll_management" asp-action="Index" class="btn btn-outline-secondary">Refresh</a>
    </div>
  </div>

  @if (TempData["msg"] is string msg)
  {
      <div class="alert alert-info">@msg</div>
  }

  <!-- Add / Upsert -->
  <div class="card mb-4">
    <div class="card-header fw-semibold">Add / Update Payroll Summary</div>
    <div class="card-body">
      <form asp-controller="payroll_management" asp-action="Add" method="post" class="row g-3">
        @Html.AntiForgeryToken()
        <div class="col-md-4">
          <label class="form-label">Employee Name (First Last)</label>
          <input name="EmployeeName" class="form-control" required />
        </div>

        <div class="col-md-3">
          <label class="form-label">Period Code</label>
          <input name="PeriodCode" class="form-control" placeholder="e.g. 2025-11-M1" />
        </div>

        <div class="col-md-2">
          <label class="form-label">Start</label>
          <input name="PeriodStart" type="date" class="form-control" />
        </div>
        <div class="col-md-2">
          <label class="form-label">End</label>
          <input name="PeriodEnd" type="date" class="form-control" />
        </div>

        <div class="col-md-2">
          <label class="form-label">Pay Rate</label>
          <input name="PayRate" type="number" step="0.01" class="form-control" required />
        </div>
        <div class="col-md-2">
          <label class="form-label">Gross</label>
          <input name="Gross" type="number" step="0.01" class="form-control" required />
        </div>
        <div class="col-md-2">
          <label class="form-label">Deductions</label>
          <input name="Deductions" type="number" step="0.01" class="form-control" required />
        </div>

        <div class="col-12 text-end">
          <button class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Table -->
  <div class="table-responsive shadow-sm">
    <table class="table table-bordered align-middle text-center">
      <thead class="table-primary">
        <tr>
          <th>Employee</th>
          <th>Period</th>
          <th>Pay rate</th>
          <th>Gross</th>
          <th>Deductions</th>
          <th>Net</th>
          <th>Status</th>
          <th>Export</th>
        </tr>
      </thead>
      <tbody>
      @if (!rows.Any())
      {
        <tr><td colspan="8" class="text-muted">No payroll rows yet.</td></tr>
      }
      else
      {
        foreach (var r in rows)
        {
          <tr>
            <td>@r.EmployeeName</td>
            <td>@r.PeriodCode</td>
            <td>@r.PayRate</td>
            <td>@r.Gross</td>
            <td>@r.Deductions</td>
            <td>@r.Net</td>
            <td>@r.Status</td>
            <td>
              <a class="btn btn-sm btn-outline-success"
                 asp-controller="payroll_management"
                 asp-action="Download"
                 asp-route-id="@r.Id">CSV</a>
            </td>
          </tr>
        }
      }
      </tbody>
    </table>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>